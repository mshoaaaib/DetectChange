on:
  repository_dispatch:
    types:
      - jira.issue_transitioned

jobs:
  run_curl_request:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '14' # You can change this to the version you want

      - name: Install cURL
        run: sudo apt-get update && sudo apt-get -y install curl

      - name: Update Custom Field in Jira
        run: |
          TICKET_NUMBER=$INPUT_TICKET_NUMBER
          API_URL="https://testjiragitautomation.atlassian.net/rest/api/2/issue/${TICKET_NUMBER}"
          AUTH_HEADER="Authorization: Bearer ATATT3xFfGF0YxvyEEFeezKjbfe1Zhn8IVrCBFkGTH8TTjMqRa89nYRPV6Kif8Ep5it1MK_e6Jka9_BnyGvbssiuv04ur9zwie_KXmsB6ijtE7_hvU-8uF52ePZW7VHyVHNgdgx0gvdFu31FHQFF8OjYpz9v4AiXUKhIFPy806HN-kR6g3wamLU=57C12695"
          CUSTOM_FIELD_ID="customfield_10037"
          NEW_FIELD_VALUE="New Value"

          curl -X PUT -H "$AUTH_HEADER" -H "Content-Type: application/json" -d '{
            "fields": {
              "'$CUSTOM_FIELD_ID'": "'$NEW_FIELD_VALUE'"
            }
          }' "$API_URL"
        env:
          INPUT_TICKET_NUMBER: ${{ github.event.client_payload.ticket_number }}
